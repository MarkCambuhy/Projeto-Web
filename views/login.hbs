<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="stylesheets/login.css">

</head>

<body>
    <form action="login" method="post" class="box-login">
        <h2>Login</h2>
        <div class="ipunt-box">
            <i class="email-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-envelope" viewBox="0 0 16 16">
                    <path
                        d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" />
                </svg>
            </i>
            <input type="email" name="email" placeholder="Email" required>
        </div>
        <div class="ipunt-box">
            <i class="lock-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-lock-fill" viewBox="0 0 16 16">
                    <path
                        d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" />
                </svg>
            </i>
            <input type="password" name="password" placeholder="Password">
        </div>
        <button type="submit" class="submit-btn" id="submit-btn">Logar</button>
        <span><a href="register">Criar conta</a></span>
    </form>
    <script>
        const username = document.querySelector('input[name=username]'),
            password = document.querySelector('input[name=password]'),
            submit = document.querySelector('input[type=submit]'),
            form = document.querySelector('form'),
            container = document.querySelector('.container'),
            message = document.querySelector('.message');

      let token = localStorage.getItem('token');
      if (token) {
        form.style.display = 'none';
      }

      submit.addEventListener('click', async (ev) => {
        ev.preventDefault();
        ev.stopPropagation();

        try {
          const response = await axios.post('./login', {
            username: username.value,
            password: password.value
          });

          if (response.data.token) {
            form.style.display = 'none';
            token = response.data.token;
            localStorage.setItem('token', token);
          }
        } catch (e) {
          message.innerHTML = 'errou!!!';
          console.log(e);
        }

        return false;
      });

      setInterval(async () => {
        try {
          const response = await axios.get('./data', {
            headers: {
              Authorization: `Bearer ${token}`
            }
          });
          container.innerHTML = response.data.message;
        } catch (e) {
          container.innerHTML = 'Sem login n√£o funciona';
        }
      }, 5000);
    </script> 

</body>

</html>